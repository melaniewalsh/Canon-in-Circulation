---
title: "Norton"
author: "Tony"
date: "2025-07-16"
output: html_document
---

```{r}
options(repos = c(CRAN = "https://cloud.r-project.org"))

cat("\014")
rm(list = ls())
install.packages("plotly")
df <- read.csv("https://seattle-library-checkout-data.s3.us-west-2.amazonaws.com/norton-anthology_spl-checkouts_2005-2025.csv")
```

```{r}
library("tidyverse")
library("plotly")
# most checked out authors
top_authors <- df %>%
  group_by(Normalized.Creator) %>%
  summarise(TotalCheckouts = sum(Checkouts, na.rm = TRUE)) %>%
  arrange(desc(TotalCheckouts)) %>%
  slice_head(n = 10)

print("Top 10 Most Checked Out Authors:")
print(top_authors)

# most checked out titles
top_titles <- df %>%
  group_by(Normalized.Title) %>%
  summarise(TotalCheckouts = sum(Checkouts, na.rm = TRUE)) %>%
  arrange(desc(TotalCheckouts)) %>%
  slice_head(n = 10)

print("Top 10 Most Checked Out Titles:")
print(top_titles)


# Bar chart for top authors
ggplot(top_authors, aes(x = reorder(Normalized.Creator, TotalCheckouts), y = TotalCheckouts)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() +
  labs(title = "Top 10 Checked Out Authors", x = "Author", y = "Total Checkouts")

# Bar chart for top titles
ggplot(top_titles, aes(x = reorder(Normalized.Title, TotalCheckouts), y = TotalCheckouts)) +
  geom_bar(stat = "identity", fill = "darkgreen") +
  coord_flip() +
  labs(title = "Top 10 Checked Out Titles", x = "Title", y = "Total Checkouts")
```

```{r}
# Create CheckoutDate column
df <- df %>%
  mutate(CheckoutDate = as.Date(paste(CheckoutYear, CheckoutMonth, "01", sep = "-")))

# Find top 10 authors by total checkouts
top10_authors <- df %>%
  group_by(Normalized.Creator) %>%
  summarise(TotalCheckouts = sum(Checkouts, na.rm = TRUE)) %>%
  arrange(desc(TotalCheckouts)) %>%
  slice_head(n = 10) %>%
  pull(Normalized.Creator)

# Filter data to include only top 10 authors
top_authors_df <- df %>%
  filter(Normalized.Creator %in% top10_authors)

# Group by date and author
author_ts_all <- top_authors_df %>%
  group_by(CheckoutDate, Normalized.Creator) %>%
  summarise(Checkouts = sum(Checkouts, na.rm = TRUE), .groups = "drop")

# Reorder authors by total checkouts (descending)
author_order <- author_ts_all %>%
  group_by(Normalized.Creator) %>%
  summarise(Total = sum(Checkouts, na.rm = TRUE)) %>%
  arrange(desc(Total)) %>%
  pull(Normalized.Creator)

author_ts_all$Normalized.Creator <- factor(author_ts_all$Normalized.Creator, levels = author_order)

# Plot
authors <- ggplot(author_ts_all, aes(x = CheckoutDate, y = Checkouts, color = Normalized.Creator)) +
  geom_line(size = 1) +
  labs(
    title = "Monthly Checkouts for Top 10 Authors",
    x = "Date", y = "Checkouts", color = "Author(Descending)"
  ) +
  theme_minimal()
ggplotly(authors)
```

```{r}
# Normalize the date
df <- df %>%
  mutate(CheckoutDate = as.Date(paste(CheckoutYear, CheckoutMonth, "01", sep = "-")))

# Get top 10 titles by total checkouts
top_10_titles <- df %>%
  group_by(Normalized.Title) %>%
  summarise(TotalCheckouts = sum(Checkouts, na.rm = TRUE)) %>%
  arrange(desc(TotalCheckouts)) %>%
  slice_head(n = 10) %>%
  pull(Normalized.Title)

# Filter to top 10 titles only
df_top_titles <- df %>%
  filter(Normalized.Title %in% top_10_titles)

# Group by title and checkout date
title_time_series <- df_top_titles %>%
  group_by(Normalized.Title, CheckoutDate) %>%
  summarise(Checkouts = sum(Checkouts, na.rm = TRUE), .groups = "drop")

# Reorder titles by total checkouts (descending)
title_order <- title_time_series %>%
  group_by(Normalized.Title) %>%
  summarise(Total = sum(Checkouts, na.rm = TRUE)) %>%
  arrange(desc(Total)) %>%
  pull(Normalized.Title)

title_time_series$Normalized.Title <- factor(title_time_series$Normalized.Title, levels = title_order)

authors <- ggplot(title_time_series, aes(x = CheckoutDate, y = Checkouts, color = Normalized.Title)) +
  geom_line(size = 1) +
  labs(
    title = "Monthly Checkouts for Top 10 Titles",
    x = "Date", y = "Checkouts", color = "Title(Descending)"
  ) +
  theme_minimal() +
  theme(legend.position = "right") # default vertical legend
ggplotly(authors)
```

```{r}
butler_df <- df %>%
  filter(Normalized.Creator == "Octavia E. Butler") %>%
  group_by(CheckoutDate) %>%
  summarise(Checkouts = sum(Checkouts, na.rm = TRUE))

butler <- ggplot(butler_df, aes(x = CheckoutDate, y = Checkouts)) +
  geom_line(color = "steelblue", size = 1) +
  labs(title = "Monthly Checkouts: Octavia E. Butler", x = "Date", y = "Checkouts") +
  theme_minimal()
ggplotly(butler)
```
```{r}
parable_df <- df %>%
  filter(Normalized.Title == "Parable Of The Sower") %>%
  group_by(CheckoutDate) %>%
  summarise(Checkouts = sum(Checkouts, na.rm = TRUE))

ggplot(parable_df, aes(x = CheckoutDate, y = Checkouts)) +
  geom_line(color = "firebrick", size = 1) +
  labs(title = "Monthly Checkouts: Parable Of The Sower", x = "Date", y = "Checkouts") +
  theme_minimal()
```

```{r}
oliver_df <- df %>%
  filter(Normalized.Creator == "Mary Oliver") %>%
  group_by(CheckoutDate) %>%
  summarise(Checkouts = sum(Checkouts, na.rm = TRUE))

ggplot(oliver_df, aes(x = CheckoutDate, y = Checkouts)) +
  geom_line(color = "darkgreen", size = 1) +
  labs(title = "Monthly Checkouts: Mary Oliver", x = "Date", y = "Checkouts") +
  theme_minimal()
```

