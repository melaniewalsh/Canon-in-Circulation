---
title: "Deaths of the Authors"
output: rmarkdown::github_document
---
```{r}
spl_df <- read.csv("https://seattle-library-checkout-data.s3.us-west-2.amazonaws.com/norton-anthology_spl-checkouts_2005-2025.csv")

library(dplyr)

library(tidyverse)

author_data <- filter(spl_df, Normalized.Creator %in% c("John Updike", "Philip Roth", "Mary Oliver", "Toni Morrison", "Joan Didion", "N. Scott Momaday", "David Foster Wallace"))

author_data <- author_data |> mutate("CheckoutDate" = as.Date(paste(CheckoutYear, CheckoutMonth, "1", sep = "-")))

author_data <- author_data %>%
    group_by(CheckoutDate, Normalized.Creator) %>%
    summarise(Checkouts = sum(Checkouts))

author_info <- data.frame(
    Normalized.Creator = c("Joan Didion", "John Updike", "Mary Oliver", "N. Scott Momaday", "Philip Roth", "Toni Morrison", "David Foster Wallace"),
    DeathDate = as.Date(c("2021-12-23", "2009-01-27", "2019-01-17", "2024-01-24", "2018-05-22", "2019-08-05", "2008-09-12"))
)

# joining
author_data <- left_join(author_data, author_info, by = "Normalized.Creator")

typeof(author_data$CheckoutDate)
typeof(author_data$DeathDate)
author_data$CheckoutDate <- as.Date(author_data$CheckoutDate)

ggplot(author_data) +
    geom_line(aes(x = CheckoutDate, y = Checkouts), size = 0.75) +
    facet_wrap(~Normalized.Creator, scales = "free", nrow = 4, ncol = 2) +
    geom_vline(aes(xintercept = DeathDate, linetype = "Death Date"), color = "red", size = 1) +
    labs(
        x = "Checkout Date",
        y = "Number of Checkouts",
        title = "SPL Checkouts For Authors Who Died After 2005",
        subtitle = "Authors Selected from the Norton Anthology",
        linetype = ""
    ) +
    scale_linetype_manual(values = c("Death Date" = "dashed"))
```